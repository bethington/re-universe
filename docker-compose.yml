services:
  # Ghidra Server - Main analysis backend
  ghidra-server:
    image: blacktop/ghidra:latest
    container_name: ghidra-server
    command: server
    ports:
      - ${GHIDRA_PORT:-13100}:13100  # Ghidra server port
      - ${GHIDRA_PORT_RANGE_START:-13101}:13101
      - ${GHIDRA_PORT_RANGE_END:-13102}:13102
    volumes:
      - ${REPO_DATA_PATH:-./repo-data}:/repos
    environment:
      - JVM_OPTS=-Xmx${JVM_MAX_MEMORY:-4g}
      - GHIDRA_IP=${GHIDRA_IP:-localhost}
      - GHIDRA_USERS=${GHIDRA_USERS:-admin}
    networks:
      - backend

  # ret-sync relay server (placeholder for future implementation)
  ret-sync-relay:
    image: alpine:latest
    container_name: ret-sync-relay
    command: sleep infinity  # Placeholder - will be replaced with actual ret-sync server
    ports:
      - "${RETSYNC_PORT:-9100}:9100"   # ret-sync default port
    volumes:
      - ${SYNC_LOGS_PATH:-./sync-logs}:/sync-logs
    depends_on:
      - ghidra-server
    networks:
      - backend

networks:
  backend:
